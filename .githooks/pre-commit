#!/bin/sh

set -e

staged_files=$(git diff --cached --name-only)

if [ -z "$staged_files" ]; then
  echo "Nenhum arquivo em staging. Abortando execução do Checkstyle."
  exit 0
fi

echo "Rodando Checkstyle com Gradle nos arquivos staged..."

echo "Executando Checkstyle para o código principal..."
./gradlew checkstyleMain || { echo "Erro ao rodar Checkstyle no código principal"; exit 1; }

echo "Executando Checkstyle para os testes..."
./gradlew checkstyleTest || { echo "Erro ao rodar Checkstyle nos testes"; exit 1; }

exit 0

## IMPORTANTE: Antes de fazer qualquer commit, configurar o pre-commit usando 
## o comando `git config core.hooksPath .githooks` para indicar o hook as 
## configurações do git
